---
title: "Experimental design"
author: "BIOSCI220"
date: "Semester 1 2020"
output:
  html_document:
    toc: true
    toc_float: true
    theme: yeti
    toc_depth: 3
    highlight: espresso
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE,message = FALSE, warning = FALSE,fig.align = "center")
library(animation)
library(emoGG)
library(ggplot2)
```

## Learning Objectives

By the end of this lab student should be able to

   + Identify the following experimental variables
      + independent variable
      + dependent variable
   + List and describe Fisher's three principals of experimental design
       + Randomization
       + Replication
       + Blocking
   + Identify the design concepts used in given case studies
   + Discuss the advantages and disadvantages of different designs
   + Critique experimental designs
   

### Suggested reading

<!-- [Glass, David J. Experimental Design for Biologists. Second ed. 2014. Print.](https://catalogue.library.auckland.ac.nz/primo-explore/fulldisplay?docid=uoa_alma21237737730002091&search_scope=Combined_Local&tab=books&vid=NEWUI&context=L) -->

<!-- [Welham, S. J. Statistical Methods in Biology : Design and Analysis of Experiments and Regression. 2015. Print.](https://catalogue.library.auckland.ac.nz/primo-explore/fulldisplay?docid=uoa_alma21237737830002091&search_scope=Combined_Local&tab=books&vid=NEWUI&context=L) -->

<!-- [Heath, David. An Introduction to Experimental Design and Statistics for Biology. London: UCL, 1995. Print.](https://catalogue.library.auckland.ac.nz/primo-explore/fulldisplay?docid=uoa_alma21133208810002091&search_scope=Combined_Local&tab=books&vid=NEWUI&context=L) -->

<!-- [Fisher, Ronald Aylmer. The Design of Experiments. 8th ed. Edinburgh: Oliver & Boyd, 1966. Print. O & B Paperbacks.](https://catalogue.library.auckland.ac.nz/primo-explore/fulldisplay?docid=uoa_alma21198532990002091&context=L&vid=NEWUI&lang=en_US&search_scope=Combined_Local&adaptor=Local%20Search%20Engine&isFrbr=true&tab=books&query=any,contains,The_Design_of_Experiments&sortby=date&facet=frbrgroupid,include,627497507&offset=0) -->

<!-- [Goldacre, Ben. "Bad Science: Quacks, Hacks, and Big Pharma Flacks." (2010).](https://lib.hpu.edu.vn/handle/123456789/29333) -->

```{r url}
knitr::include_url("https://www.youtube.com/embed/3IA0lKf-xJI",height = "400px")
```

Visit [Wild About Statistics](https://www.stat.auckland.ac.nz/~wild/wildaboutstatistics/) for some more related content 

[Suresh K P. An overview of randomization techniques: An unbiased assessment of outcome in clinical research. Journal of Human Reproductive Science 2011;4:8-11](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3136079/)

[Gelman, A. T., \& Loken, E.The garden of forking paths: Why multiple comparisons can be a problem, even when there is no “fishing expedition” or “p-hacking” and the research hypothesis was posited ahead of time.](http://www.stat.columbia.edu/~gelman/research/unpublished/p_hacking.pdf)





## Key phrases

 + Biological question (**AVOID BEING VAGUE**)
    + Should include details such as what is being *compared*, what is being *measured* and *how*, and under what *experimental conditions* etc.
 + Treatment:
    + the experimental condition independently applied to the **experimental unit**
 + Experimental unit:
    + the physical entity which can be assigned to a **treatment**
 + Observational unit:
    + the smallest unit on which a response is measured
 + Replication.
    + Each treatment is *independently* applied to each of several **experimental units** $\rightarrow$ to generalise results to the population.
    + Multiple samples from the same **experimental unit** are taken and processed $\rightarrow$ increases precision, accounts for variation.
    + Multiple measurements are taken per sample $\rightarrow$ good for noisy measuring instruments.
 + Randomisation:
    + protects against bias
 + Blocking:
    + two units in the same block get different treatments the treatments can be compared more precisely than if the treatments were assigned to units in different blocks

### Example: herbicide

*Biological question* How much herbicide residue is left in a plot of sprayed soil 2 weeks post spraying? We compare 2 herbicides: Weedz and B180. We randomly spray each of 5 plots of weeds with Weedz and the other 5 with B180.

*Treatment*: 2 herbicides: Weedz and B180.

*Experimental unit*: Plots

*Observational unit*: changes depending on the scenario.

   + A single core taken from each plot and one measurement per core taken $\rightarrow$ plot
   + A single core taken from each plot and 6 subsamples are then taken from each core, measurements per subsample are taken $\rightarrow$ subsample
   + 4 cores are taken from each plot and from each core a measurement is taken $\rightarrow$ core
   
### Dependent and independent variables


How do controllable inputs (treatment factors/independent variable) impact outcomes of interest (responses/dependent variable)?

```{r ivdv, fig.height=10,fig.width=10}
d <- data.frame(y = rep(3:1,times = c(6,1,3)),x = c(-1,-0.1,0.1, 0.9,1,1.1,0,-1,0,1))
ggplot(d,aes(x = x, y = y)) + geom_emoji(data = d[1:6,],emoji = "1f4a7",size = 0.05) + geom_emoji(data = d[7,],emoji = "1f4cf",size = 0.1) +
  geom_emoji(data = d[8,],emoji = "1f331",size = 0.1) + geom_emoji(data = d[9,],emoji = "1f33f",size = 0.1) +
  geom_emoji(data = d[10,],emoji = "1f333",size = 0.1) + 
  theme_void() + xlim(c(-2,2)) + ylim(c(-1,4)) +  
  annotate("text", x = 0, y = 2.5, label = " The independent variable represents a \n quantity that is being manipulated (e.g., amount of water)") +  
  annotate("text", x = 0, y = 1.5, label = " The dependent variable represents a quantity \n that depends on the independent variable (e.g., height of plant)")

```
   
   
## A simple design: Independent measures (between subjects)

Separate groups are created for each treatment (i.e., each participant is assigned to only one treatment group); participants can only be a member of **one** of the groups

```{r independent,message=FALSE,cache=TRUE,results='hide'}
plot(1:15, rep(1,15),col = rep(1:3,each = 5),pch = 20,axes = FALSE, xlab = "",ylab = "",cex = 4);
legend("topleft",bty = "n",pch = 20, col = 1:3, legend = c("Group 1","Group 2", "Control"))

```

**Advantages**

 + simple design setup
 + multiple treatments can be tested at the same time
 + quick
    
**Disadvantages**

  + each participant is only being tested once
  + complex if more than a few treatments are being tested
  + differences in individuals may skew results
  + bias (selection or accidental) can be an issue 
    

## Fisher's principles of experimental design


### Randomization

Plan the experiment in such a way that the variations caused by extraneous factors can all be combined under the general heading of "chance".


```{r flip,message=FALSE,cache=TRUE,results='hide'}
pngs <- list.files("../gifs/","coin.png",full = TRUE)
imgs <- lapply(pngs,png::readPNG)
ani.options(interval = 0.5)
dir <- getwd()
setwd("../gifs")
saveGIF(
    for(i in 1:2){
        plot(1,type = "n", axes = FALSE,xlim = c(-0.6,0.6),xlab ="",ylim = c(-0.6,0.6),ylab = "")
        rasterImage(imgs[[i]],-0.5,-0.5,0.5,0.5)
    },movie.name = "flip.gif"
)
setwd(dir)
```

![](../gifs/flip.gif)

**Advantages** 
  
  + ensures that each treatment has the same
probability of getting good (or bad) units and thus
avoids systematic bias
    + random allocation can cancel out population bias; it ensures that any other possible causes for the experimental results are split equally between groups
    + typically statistical analysis assumes that observations are
independent. This is almost never strictly true in practice
but randomisation means that our estimates will behave
as if they were based on independent observations


### Replication 

**An experiment should be repeated more than once**

We should repeat an experiment to fully assess variability and enable us to (with caution) generalize results. For true replication the entire process must be repeated separately each time.

```{r repeated,message=FALSE,cache=TRUE,results='hide'}
plot(1:15, rep(1.5,15),col = rep(1:3,each = 5),pch = 17,axes = FALSE, xlab = "",ylab = "",cex = 3,ylim = c(0,2.5))
points(1:15,rep(1,15),col = rep(1:3,each = 5),pch = 18,cex = 3)
points(1:15,rep(0.5,15),col = rep(1:3,each = 5),pch = 19, cex = 3)
legend("topleft",bty = "n",pch = 17:19, col = "grey", legend = paste("Treatment", 1:3))
legend("topright",bty = "n",pch = 20, col = 1:3, legend = paste("Patient", 1:3))

```


  **Advantages** 
  
  + variability between subjects already controlled for
    + we can estimate the inherent variability in the data from the replicate observations
    + allows us to judge whether an observed difference could be due to chance
variation
    
  **Disadvantages**
  
  + possibility that the position of the treatment in the order of treatments matters
    + randomization can correct for this.
  + carryover effects (i.e., one part of the experiment can have trickle down effects to subsequent parts)
  + death or dropout of subjects 







### Blocking

#### Randomised block design 


Blocking helps control variability by making treatment groups more alike. Experimental units are divided into subsets (called
blocks) so that units within the same block are more similar than units from different subsets or blocks. 

In a randomized block design, the researcher divides experimental subjects into homogeneous blocks. Treatments are then randomly assigned to the blocks. The variability within blocks should be greater than the variability between blocks. In other words, you need to make sure that the blocks contain subjects that are very similar. 


```{r random block,echo = FALSE}
block <- rep(1:4, each = 4)
set.seed(4321)
treatment <- c(replicate(4,sample(1:4,size = 4)))
plot(1:16,rep(1,length(block)),col = block,pch = treatment + 14,axes = FALSE,xlab = "",ylab = "",cex = 3)
legend("topright",bty = "n", pch = 15:18, legend = paste("Treatment",1:4), col = "grey")
legend("topleft",bty = "n", pch = 20, col = 1:4, legend = paste("Block",1:4))

```


**Advantages**

  + if two units in the same block get different treatments
the treatments can be compared more precisely than if
the treatments were assigned to units in different blocks
  + blocking allows us to increase our ability to detect
differences without increasing the size of the
experiment



## Quizzes

#### Practise quiz will be available on CANVAS a week before the lab (do not count towards your final grade)

#### Pre lab quiz on CANVAS (worth 1\% of final grade)

## Lab work (worth 6\% of your final grade)

#### Design your own experiment  

As part of your assessed lab work this week you are to design your own experiment. Please upload a .pdf of your answers to the following to CANVAS before the deadline.

```{r url2}
knitr::include_url("https://www.youtube.com/embed/FnyrV-zxwis",height = "400px")
```

 + Choose a topic of interest and identify a question you have related to that topic. Write a few sentences outlining the scientific question you have and any related hypotheses. Clearly identify the goals and objectives of your experiment.

 
 + Note the variables (independent and dependent) and units in your scenario, mentioning the ranges and potential relationship between them.
 
 + Design an experiment that could help you test the hypothesis/answer the question your question of interest. Write a few short paragraphs outlining the experimental design describing how Fisher's three principles of experimental design have played a part.
 
 + List and justify the methods and instruments required for your experiment.

 + Critique your experimental design and suggest ways to improve it and discuss any limitations you foresee. 

 + As part of this lab you are also expected to peer review 3 of your classmate's worksheets. Although this will be an anonymous process, from the view of the lab, be aware that your feedback will be returned to your peers. When carrying out your peer review please follow the rubric given fairly and carefully. Note that student peer reviews will be considered complete when students have commented at least once on the page and filled out the rubric form for each assignment.