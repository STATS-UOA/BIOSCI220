---
title: "Experimental design"
author: "BIOSCI220"
date: "Semester 1 2020"
output:
  rmdformats::readthedown:
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: false
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE,message = FALSE, warning = FALSE)
library(animation)
library(emoGG)
library(ggplot2)
```

## Learing Objectives

By the end of this lab student should be able to

   + Identify the following variables
      + independent variable
      + dependent variable
   + Describe the setup of the following experimental designs
       + independent measures (between groups)
       + repeated measures (within groups)
       + randomisation
   + Identify the type of design used in the given case studies
   + Discuss the advantages and disadvantages of different design types
   + Critique experimental designs used in the the given case studies
   + Design an experiment that follows good experimental design principles


### Suggested reading

[Experimental design for biologists](https://catalogue.library.auckland.ac.nz/primo-explore/fulldisplay?docid=uoa_alma21237737730002091&search_scope=Combined_Local&tab=books&vid=NEWUI&context=L)

[Statistical methods in biology : design and analysis of experiments and regression](https://www.library.auckland.ac.nz/search/experimental%20design%20biology)

[An introduction to experimental design and statistics for biology](https://catalogue.library.auckland.ac.nz/primo-explore/fulldisplay?docid=uoa_alma21133208810002091&search_scope=Combined_Local&tab=books&vid=NEWUI&context=L)


## Dependent and independent variables

```{r ivdv, fig.height = 5,fig.width = 5}
d <- data.frame(y = rep(3:1,times = c(6,1,3)),x = c(-1,-0.1,0.1, 0.9,1,1.1,0,-1,0,1))
ggplot(d,aes(x = x, y = y)) + geom_emoji(data = d[1:6,],emoji = "1f4a7",size = 0.05) + geom_emoji(data = d[7,],emoji = "1f4cf",size = 0.1) +
  geom_emoji(data = d[8,],emoji = "1f331",size = 0.1) + geom_emoji(data = d[9,],emoji = "1f33f",size = 0.1) +
  geom_emoji(data = d[10,],emoji = "1f333",size = 0.1) +
  theme_void() + xlim(c(-2,2)) + ylim(c(-1,4)) +  
  annotate("text", x = 0, y = 2.5, label = " The independent variable represents a \n quantity that is being manipulated (e.g., amount of water)") +  
  annotate("text", x = 0, y = 1.5, label = " The dependent variable represents a quantity \n that depends on the intependent variable (e.g., height of plant)")

```

## Independent measures (between subjects)

Separate groups are created for each treatment (i.e., each participant is assigned to only one treatment group); participants can only be a member of **one** of the groups

```{r independent,message=FALSE,cache=TRUE,results='hide'}
plot(1:15, rep(1,15),col = rep(1:3,each = 5),pch = 20,axes = FALSE, xlab = "",ylab = "",cex = 4);
legend("topleft",bty = "n",pch = 20, col = 1:3, legend = c("Group 1","Group 2", "Control"))

```

  + Advantages
    + simple design setup
    + multiple treatments can be tested at the same time
    + quick
  + Disadvantages
    + each participant is only being tested once
    + complex if more than a few treatments are being tested. Other disadvantages include:
    + differences in individuals may skew results
    + bias can be an issue 
      + control for this by using experimental blinds?
        + single blind, the participant doesn’t know if they are getting a treatment or placebo
        + double blind, where neither the participant nor the researcher know


## Repeated measures (within groups)

We should repeat an experiment to fully assess variability and enable us to (with caution) generalise results. Here, each group member is tested **multiple** times or under **different** conditions.

```{r repeated,message=FALSE,cache=TRUE,results='hide'}
plot(1:15, rep(1.5,15),col = rep(1:3,each = 5),pch = 17,axes = FALSE, xlab = "",ylab = "",cex = 3,ylim = c(0,2.5))
points(1:15,rep(1,15),col = rep(1:3,each = 5),pch = 18,cex = 3)
points(1:15,rep(0.5,15),col = rep(1:3,each = 5),pch = 19, cex = 3)
legend("topleft",bty = "n",pch = 17:19, col = "grey", legend = paste("Treatment", 1:3))
legend("topright",bty = "n",pch = 20, col = 1:3, legend = paste("Patient", 1:3))

```


rdinary repeated measures is where patients are assigned a single treatment, and the results are measured over time (e.g. at 1, 4 and 8 weeks).
A crossover design is where patients are assigned all treatments, and the results are measured over time.
The most common crossover design is “two-period, two-treatment.” Participants are randomly assigned to receive either A and then B, or B and then A.

One important fact that sets crossover designs apart from the “usual” type of experiment is that the same patients are in the control group and all of the treatment groups. A patient is measured by how well they respond to treatments against themselves; the “control” is the original status of the patient. For example, a patient undergoing nutritional counseling is measured before treatment (the control part) and after treatment (the experimental part).


  + Advantages 
    + fewer patients are needed overall
    + variability between subjects already controled for
    
  + Disadvantages
     + possibility that the position of the treatment in the order of treatments matters
       + randomization or counterbalancing can correct for this.
     + carryover fffects (i.e., one part of the experiment can have trickle down effects to subsequent parts)
     + death or dropout of subjects 

## Randomisation


```{r flip,message=FALSE,cache=TRUE,results='hide'}
pngs <- list.files("../gifs/","coin.png",full = TRUE)
imgs <- lapply(pngs,png::readPNG)
ani.options(interval = 0.5)
dir <- getwd()
setwd("../gifs")
saveGIF(
    for(i in 1:2){
        plot(1,type = "n", axes = FALSE,xlim = c(-0.6,0.6),xlab ="",ylim = c(-0.6,0.6),ylab = "")
        rasterImage(imgs[[i]],-0.5,-0.5,0.5,0.5)
    },movie.name = "flip.gif"
)
setwd(dir)
```

![](../gifs/flip.gif)


Evenly distributes any variability in outcome due to outside factors across treatment groups. 

Example: double-blind medical trials, neither patient nor doctor knows which group has been assigned, group assignment is made randomly by 3rd party


### Randomised block design 


Blocking helps control variability by making treatment groups more alike
Inside of groups, differences will be minimal. Across groups, differences will be
larger. In randomised block design, the researcher divides experimental subjects into homogeneous blocks. Treatments are then randomly assigned to the blocks. The variability within blocks should be greater than the variability between blocks. In other words, you need to make sure that the blocks contain subjects that are very similar. For example, you could put males in one block and females in a second block. 


```{r random block,echo = FALSE}
block <- rep(1:4, each = 4)
set.seed(4321)
treatment <- c(replicate(4,sample(1:4,size = 4)))
plot(1:16,rep(1,length(block)),col = block,pch = treatment + 14,axes = FALSE,xlab = "",ylab = "",cex = 3)
legend("topright",bty = "n", pch = 15:18, legend = paste("Treatment",1:4), col = "grey")
legend("topleft",bty = "n", pch = 20, col = 1:4, legend = paste("Block",1:4))

```

#### Matched pairs design

Matched pairs design is a special case of randomized block design. In this design, two treatments are assigned to homogeneous groups (blocks) of subjects. The goal is to maximize homogeneity in each pair. In other words, you want the pairs to be as similar as possible. The blocks are composed of matched pairs which are randomly assigned a treatment (commonly the drug or a placebo).

For example, an experiment to test a new drug may have blocks of 200 males and 200 females. Each block contains 100 pairs, who are matched according to some criteria other than sex (like age, other medications, or health conditions). Each pair is then treated like a block, with each randomly assigned to receive the drug or a placebo. 

### Randomised controlled design 

A randomized controlled trial is an experiment where the participants are randomly allocated to two or more groups to test a specific treatment or drug. Participants are assigned to either an experimental group or a comparison group. Random allocation means that all participants have the same chance of being placed in either group. 


```{r random_controlled,message=FALSE,cache=TRUE,results='hide'}
ani.options(interval = 1)
dir <- getwd()
setwd("../gifs")
saveGIF(
for(i in 1:10){
  plot(1:10, rep(1,10),col = 1,pch = 20,axes = FALSE, xlab = "",ylab = "",cex = 4)
  legend("topleft",bty = "n",pch = 20, col = 1, legend = "Patients")
  treatment <- sample(1:2,replace = TRUE, size = 10)
  plot(1:10, rep(1,10),col = treatment,pch = 20,axes = FALSE, xlab = "",ylab = "",cex = 4);
  legend("topleft",bty = "n",pch = 20, col = 1:2, legend = c("Experimental group", "Comparison group"))
},movie.name = "rcontrolled.gif")
setwd(dir)
```

![](../gifs/rcontrolled.gif)


### Advantages and Disadvantages of Randomized Controlled Trials
#### Advantages

Random allocation can cancel out population bias; it ensures that any other possible causes for the experimental results are split equally between groups.

Blinding is easy to include in this type of experiment.

Results from the experiment can be analyzed with statistical tests and used to infer other possibilities, like the likelihood of the method working for all populations.

Participants are readily identifiable as members of a specific population.

#### Disadvantages

Generally more expensive and more time consuming than other methods.

Very large sample sizes (over 5,000 participants) are often needed.

Random controlled trials cannot uncover causation/risk factors. For example, ethical concerns would prevent a randomized controlled trial investigating the risk factors for smoking.

This type of experimental design is unsuitable for outcomes which take a long time to develop. Cohort studies may be a more suitable alternative.

Some programs, for example cancer screening, are unsuited for random allocation of participants (again, due to ethical concerns).

Volunteer bias can be an issue.


## Other 

## Power and Sample size

  + Power: probability that the test correctly rejects the null hypothesis when the
alternative hypothesis is true.
  + Effect size: standardized measure of the difference you're trying to detect.
  + Sample Size: How many experimental units you need to survey to detect the
desired difference at the desired power.


## Tutorial



[possible experiment](https://www.physiology.org/doi/full/10.1152/advan.00033.2006)

['The Knowledge'](https://www.bbc.com/news/health-16086233)

[Musicians' brains fire symmetrically when they listen to music](https://www.newscientist.com/article/dn28266-musicians-brains-fire-symmetrically-when-they-listen-to-music/)

In groups discuss the following for each article above.

Is there a problem with the following?

  + Confounding/interacting variables
  + Placebo effect
  + Experimenter effect
  + Ecological validity
  + Generalisability
  
### CHECK

The extent or size of any claimed effects or differences

How large is the observed effect?

How large are the samples in each group quoted?

Uncertainty expressed?

## Design your own experiment

Use this tool to test your reaction time. **Does size of the character affect your reaction time?** [Test your reaction times](https://www.justpark.com/creative/reaction-time-test/) or [green light test](https://faculty.washington.edu/chudler/java/redgreen.html)


Null Hypothesis: There is no difference.

Alternative hypothesis: Bigger dots makes it easier.