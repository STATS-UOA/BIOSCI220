---
title: "Hypothesis testing"
author: ""
date: ""
output: ioslides_presentation
---

<style type="text/css">
slides > slide:not(.nobackground):after {
  content: '';
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE,message = FALSE, warning = FALSE)
library(dplyr)
library(ggplot2)
library(magick)
library(gganimate)
library(patchwork)
```

## Hypothesis testing

<ul style="font-family: bookman, bookman; font-size:20pt; top:35%;position: absolute;">
<li> Hypothesis \& assumptions</li>
<li> Test statistic</li>
<li> What is the probability of observing that test statistic? (p-value)</li>
</ul>

## Inference about a mean

![](../gifs/os_ttest.gif)

## Inference about two means

![](../gifs/ts_ttest.gif)

## The P$\overline{\text{a}}$ua dataset

<p style="font-family: bookman, bookman; font-size:20pt"> The P$\overline{\text{a}}$ua dataset contains the following variables</p>
<ul style="font-family: bookman, bookman; font-size:20pt; top:35%;position: absolute;">
<li> Age of  P$\overline{\text{a}}$ua in years (calculated from counting rings in the
cone) </li>
<li> Length of  P$\overline{\text{a}}$ua shell in centimeters</li>
<li> Species of  P$\overline{\text{a}}$ua: *Haliotis iris* (typically found in NZ) and
*Haliotis australis* (less commonly found in NZ) </li>

</ul>

## The P$\overline{\text{a}}$ua dataset

```{r head,echo = 2}
paua <- read.csv("../data/paua.csv")
head(paua)
```

## Inference about two means

Null hypothesis: $H_0$ (that each species has on average the same length of shell) verses the alternative hypothesis, $H_1$, that they don't!

+ $H_0: \mu_{\text{Haliotis iris}} - \mu_{\text{Haliotis australis}} = 0$ vs $H_1: \mu_{\text{Haliotis iris}} \neq \mu_{\text{Haliotis australis}}$

Assumptions: 

  + Each P$\overline{\text{a}}$ua is independent of the other
  + Each datapoint (length, cm) come from the same distribution
  + The length of shells are Normally distributed
  
## Inference about two means
  
```{r bar plot,echo = FALSE, eval = TRUE}

means_df <- paua %>%
    group_by(Species) %>%
    summarize(means=mean(Length),
              sem = sd(Length)/sqrt(length(Length)))

a <- ggplot(means_df, aes(x = Species, y = means,fill = Species)) +
    geom_bar(stat = "identity") + scale_fill_brewer(palette = "Dark2") +
    geom_point(aes(x = Species, y = Length), data = paua, alpha = .25) +
    geom_errorbar(aes(ymin = means - sem, ymax = means + sem), width = .2) +
    theme(axis.title.x=element_blank(),
          axis.ticks.x=element_blank(),
          panel.background = element_blank(),
          panel.grid.minor = element_blank(),
          panel.grid.major = element_blank(),
          legend.position = "none",
          panel.border = element_rect(colour='black', fill=NA)) +
    geom_text(aes(0.4, 7,label = paste("Sample mean australis:", format(round(means_df[[1,2]], 2), nsmall = 2))),
              size = 4, hjust = 0, color = "black") +
    geom_text(aes(0.4, 6.5,label = paste("Sample mean iris:", format(round(means_df[[2,2]], 2), nsmall = 2))),
              size = 4, hjust = 0, color = "black") 

a

```
  
## Same length on average?

Using R

```{r simple,echo = TRUE, eval = TRUE}
t.test <- t.test(paua$Length~paua$Species,var.equal = FALSE)
t.test
```

## As a plot

```{r t-test plot,echo = FALSE, eval = TRUE}

stats_df <- paua %>%
    summarize(ts = t.test(Length~Species,var.equal=FALSE)$statistic)

a <- ggplot(means_df, aes(x = Species, y = means,fill = Species)) +
    geom_bar(stat = "identity") + scale_fill_brewer(palette = "Dark2") +
    geom_point(aes(x = Species, y = Length), data = paua, alpha = .25) +
    geom_errorbar(aes(ymin = means - sem, ymax = means + sem), width = .2) +
    theme(axis.title.x=element_blank(),
          axis.ticks.x=element_blank(),
          panel.background = element_blank(),
          panel.grid.minor = element_blank(),
          panel.grid.major = element_blank(),
          panel.border = element_rect(colour='black', fill=NA),
          legend.position = "none") +
    geom_text(aes(0.4, 7,label = paste("Sample mean australis:", format(round(means_df[[1,2]], 2), nsmall = 2))),
              size = 4, hjust = 0, color = "black") +
    geom_text(aes(0.4, 6.5,label = paste("Sample mean iris:", format(round(means_df[[2,2]], 2), nsmall = 2))),
              size = 4, hjust = 0, color = "black") 

## for p-value shading
crit_df <- data.frame(ts = stats_df[[1]])
crit_df$y <- dt(crit_df$ts,df = 57) ## corresponding t vals

b <- ggplot(stats_df,aes(x=ts))+
    geom_vline(aes(xintercept=ts))+
    geom_line(data=data.frame(x=seq(-5,5,.1),
                              y=dt(seq(-5,5,.1),df=57)),
              aes(x=x,y=y)) +
    theme(panel.background = element_blank(),
          panel.grid.minor = element_blank(),
          panel.grid.major = element_blank(),
          panel.border = element_rect(colour='black', fill=NA)) +
    ylab("density")+
    xlab("t-statistic")+
    geom_area(data = crit_df,mapping = aes(x = ts,y = y),fill = "grey",alpha = 0.3) +
    geom_area(data = crit_df,mapping = aes(x = -ts,y = y),fill = "grey",alpha = 0.3) +
    geom_text(aes(-4, 0.5,label = paste("t-statistic:", format(round(ts, 2), nsmall = 2))),
              size = 4, hjust = 0, color = "black") +
    geom_text(aes(-4, 0.475,label = paste("p-value:", format(round(2*pt(abs(ts),df = 57,lower.tail = FALSE), 2),
                                                             nsmall = 2))),
              size = 4, hjust = 0, color = "grey")

a + b
```


## One way ANOVA

![](../gifs/anova.gif)

## Randomization test. 

![](../gifs/random.gif)


## Next Time Linear Modelling

![](../gifs/lm.gif)



## 


<ul style="font-family: bookman, bookman; font-size:30pt; top:40%;position: absolute;">
  https://b.socrative.com/login/student/
  Room Name: BIOSCI220
 </ul>

